"use strict";var form=document.getElementById("form"),fieldsOk=[!1,!1,!1],priority=document.getElementById("priority"),date=new Date,tasks=document.getElementById("tasks"),task={created:date.getTime(),name:"",limit:"",priority:"",ended:!1},showTasks=function(){if(localStorage.length>=0){var e=document.createDocumentFragment();tasks.innerHTML="";for(var t=0;t<localStorage.length;t++){var a=document.createElement("DIV"),s=localStorage.key(t),n=JSON.parse(localStorage.getItem(s));a.classList.add("tasks__task"),a.classList.add(n.priority);var r=document.createElement("SPAN"),d=document.createElement("SPAN"),o=document.createElement("SPAN"),c=document.createElement("SPAN"),i=document.createElement("SPAN"),l=document.createElement("SPAN"),m=document.createElement("SPAN"),k=document.createElement("SPAN"),p=document.createElement("SPAN"),_=document.createElement("SPAN"),f=document.createElement("SPAN"),g=document.createElement("SPAN"),u=document.createElement("SPAN"),L=document.createElement("DIV"),v=new Image,S=document.createElement("DIV"),E=new Image;r.classList.add("tasks__task__span"),d.classList.add("tasks__task__span"),o.classList.add("tasks__task__span"),k.classList.add("tasks__task__span"),p.classList.add("tasks__task__span"),_.classList.add("tasks__task__span"),f.classList.add("tasks__task__span"),c.classList.add("tasks__task__span"),i.classList.add("tasks__task__span"),l.classList.add("tasks__task__span"),m.classList.add("tasks__task__span"),g.classList.add("tasks__task__span"),u.classList.add("tasks__task__span"),r.textContent=n.name,a.append(r),d.textContent=formatDate(n.created),a.append(d),o.textContent=formatDate(n.limit),a.append(o),k.textContent="D",a.append(k),p.textContent="H",a.append(p),_.textContent="M",a.append(_),f.textContent="S",a.append(f),a.append(c),a.append(i),a.append(l),a.append(m),g.textContent="Created:",a.append(g),u.textContent="Ends:",a.append(u),L.classList.add("tasks__task__span"),v.src="assets/images/trash.svg",v.textContent=s,v.alt="trash",L.append(v),a.append(L),S.classList.add("tasks__task__span"),S.classList.add("check"),S.id=s,1==n.ended&&(E.src="assets/images/whitecheck.png",E.textContent=s,S.append(E),a.classList.add("tasks__task__done")),a.append(S),timeLeft(n.limit,c,i,l,m,n.ended),e.append(a)}tasks.append(e)}},timeLeft=function(e,t,a,s,n,r){var d=new Date(e);!function e(){var o=new Date(d-new Date);if(t.textContent=parseInt(o.getTime()/864e5),a.textContent=parseInt(o.getTime()%864e5/36e5),s.textContent=parseInt(o.getTime()%36e5/6e4),n.textContent=parseInt(o.getTime()%36e5%6e4/1e3),o<=0||1==r)cancelAnimationFrame(e);else requestAnimationFrame(e)}()},formatDate=function(e){var t=new Date(e),a=t.getDate();return a<10&&(a="0"+a),"".concat(a,"-").concat(t.getMonth()+1,"-").concat(t.getFullYear())},addTask=function(){var e=100;if(localStorage.length>0)for(var t=0;t<localStorage.length;t++)e<localStorage.key(t)&&(e=localStorage.key(t));localStorage.setItem(++e,JSON.stringify(task));for(var a=0;a<fieldsOk.length;a++)fieldsOk[a]=!1;form.reset(),showTasks()},errorMessage=function(){var e="Incomplete form:";0==fieldsOk[0]&&(e+="\nTask name empty"),0==fieldsOk[1]&&(e+="\nDate empty"),0==fieldsOk[2]&&(e+="\nPriority not selected");var t=document.getElementById("error-message");t.textContent=e,t.classList.add("error-message"),t.addEventListener("animationend",(function(){t.textContent="",t.classList.remove("error-message")}))},fieldsEmpty=function(){""!==form.task.value&&form.task.value.length>2?(fieldsOk[0]=!0,form.task.classList.remove("border-error"),task.name=form.task.value):form.task.classList.add("border-error"),""!==form.date.value?(fieldsOk[1]=!0,form.date.classList.remove("border-error"),task.limit=form.date.value):form.date.classList.add("border-error"),fieldsOk[2]?priority.classList.remove("border-error"):priority.classList.add("border-error")},removeTask=function(e){return localStorage.removeItem(e)};addEventListener("load",(function(){showTasks()})),form.addEventListener("submit",(function(e){e.preventDefault(),fieldsEmpty(),-1!=fieldsOk.indexOf(!1)?errorMessage():addTask()})),priority.addEventListener("click",(function(e){fieldsOk[2]=!0,task.priority=e.target.value})),tasks.addEventListener("click",(function(e){"trash"==e.target.alt&&(removeTask(e.target.textContent),showTasks()),e.target.classList.contains("check")&&updateTask(e.target.id)}));var updateTask=function(e){var t=JSON.parse(localStorage.getItem(e));t.ended=!0,localStorage.setItem(e,JSON.stringify(t)),showTasks()};